<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Wander Debug Terminal</title>
</head>
<body>
  <h2>ðŸ§  Wander Wallet Debug Terminal</h2>
  <button id="connect">Connect Wallet</button>
  <button id="test" disabled>Send Test Transaction</button>
  <button id="clear">Clear</button>
  <pre id="terminal" style="background:#000;color:#0f0;padding:10px;height:400px;overflow:auto;"></pre>

  <script>
    const terminal = document.getElementById("terminal");
    const connectBtn = document.getElementById("connect");
    const testBtn = document.getElementById("test");
    const clearBtn = document.getElementById("clear");
    let connected = false;

    function log(type, msg, data) {
      const time = new Date().toLocaleTimeString();
      let entry = `[${time}] ${type.toUpperCase()}: ${msg}`;
      if (data) entry += "\n" + JSON.stringify(data, null, 2);
      terminal.textContent += entry + "\n\n";
      terminal.scrollTop = terminal.scrollHeight;
      console.log(type, msg, data || "");
    }

    function checkWallet() {
      if (!window.arweaveWallet) {
        log("error", "Wander wallet not detected");
        return false;
      }
      log("info", "Wander wallet detected");
      return true;
    }

    async function connect() {
      if (!checkWallet()) return;
      try {
        log("send", "Connecting to Wander...", { permissions: ["ACCESS_ADDRESS", "DISPATCH"] });
        await window.arweaveWallet.connect(["ACCESS_ADDRESS", "DISPATCH"]);
        const addr = await window.arweaveWallet.getActiveAddress();
        log("recv", "Connected", { address: addr });
        connectBtn.textContent = "Disconnect";
        connected = true;
        testBtn.disabled = false;
      } catch (e) {
        log("error", "Connection failed", { message: e.message });
      }
    }

    async function disconnect() {
      try {
        await window.arweaveWallet.disconnect();
        log("info", "Disconnected");
      } catch (e) {
        log("error", "Disconnect failed", { message: e.message });
      }
      connected = false;
      connectBtn.textContent = "Connect Wallet";
      testBtn.disabled = true;
    }

    async function sendTestTx() {
      try {
        const tx = {
          data: "Debug " + Date.now(),
          tags: [
            { name: "App-Name", value: "WanderDebug" },
            { name: "Content-Type", value: "text/plain" }
          ]
        };
        log("send", "Dispatching TX", tx);
        const res = await window.arweaveWallet.dispatch(tx);
        log("recv", "TX Signed", res);
      } catch (e) {
        log("error", "TX Failed", { message: e.message });
      }
    }

    connectBtn.onclick = () => connected ? disconnect() : connect();
    testBtn.onclick = sendTestTx;
    clearBtn.onclick = () => { terminal.textContent = ""; };

    window.addEventListener("arweaveWalletLoaded", () => {
      log("info", "arweaveWalletLoaded event detected âœ…");
    });

    log("info", "Wander Debug Terminal ready. Click 'Connect Wallet' to start.");
  </script>
</body>
</html>

