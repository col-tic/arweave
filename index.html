<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Native Wallet Connect</title>
<style>
  body { font-family: monospace; background: #000; color: #0f0; padding: 20px; }
  h1 { text-align: center; }
  button { padding: 10px 20px; margin: 5px; cursor: pointer; background: #0f0; color: #000; border: none; }
  button:disabled { opacity: 0.5; cursor: not-allowed; }
  pre { background: #111; padding: 10px; height: 300px; overflow: auto; }
</style>
</head>
<body>

<h1>Native Wallet Connect</h1>

<button id="connectBtn">Conectar y enviar JSON</button>
<pre id="terminal">[INFO] Terminal iniciado...</pre>

<script>
const term = document.getElementById('terminal');
const connectBtn = document.getElementById('connectBtn');

function log(msg, type='info') {
  const ts = new Date().toISOString();
  term.textContent += `\n[${ts}][${type.toUpperCase()}] ${msg}`;
  term.scrollTop = term.scrollHeight;
}

// Generar JSON de autenticaci√≥n
function createAuthJSON() {
  const timestamp = Date.now();
  return {
    app: "NativeWalletConnect",
    action: "authenticate",
    timestamp: timestamp,
    data: { user: "demo" }
  };
}

// Simula env√≠o al host nativo (Native Messaging)
async function sendToNative(jsonData) {
  // Ejemplo usando NativeWallet.sign (seg√∫n tu implementaci√≥n)
  if (!window.NativeWallet) {
    log("‚ùå NativeWallet no disponible", "err");
    return null;
  }

  try {
    log("üì§ Enviando JSON al host nativo...");
    const signed = await window.NativeWallet.sign(jsonData); // Host firma el JSON
    return signed;
  } catch (e) {
    log("‚ùå Error al enviar JSON: " + e.message, "err");
    return null;
  }
}

// Al hacer clic en Conectar
connectBtn.addEventListener("click", async () => {
  connectBtn.disabled = true;
  log("üîÑ Generando JSON de autenticaci√≥n...");
  
  const authJSON = createAuthJSON();
  log("JSON generado:");
  log(JSON.stringify(authJSON, null, 2));

  const signedData = await sendToNative(authJSON);
  if (!signedData) {
    log("‚ùå No se recibi√≥ JSON firmado", "err");
    connectBtn.disabled = false;
    return;
  }

  log("‚úÖ JSON firmado recibido del host nativo:");
  log(JSON.stringify(signedData, null, 2));

  // Validar firma
  if (signedData.signature && signedData.address) {
    log("‚úÖ Autenticaci√≥n exitosa. Direcci√≥n: " + signedData.address);
  } else {
    log("‚ùå JSON firmado inv√°lido", "err");
  }

  connectBtn.disabled = false;
});
</script>

</body>
</html>
