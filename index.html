<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Wander Debug</title>
</head>
<body>
  <h2>Wander Wallet Debug</h2>
  <button id="connect">Connect</button>
  <button id="test" disabled>Send Test TX</button>
  <pre id="log"></pre>

  <script>
    const log = (...args) => {
      console.log(...args);
      document.getElementById("log").textContent += args.join(" ") + "\n";
    };

    const connectBtn = document.getElementById("connect");
    const testBtn = document.getElementById("test");
    let connected = false;

    function checkWallet() {
      if (!window.arweaveWallet) {
        log("âŒ Wander not detected. Install or refresh.");
        alert("No Wander wallet detected.");
        return false;
      }
      log("âœ… Wander wallet detected.");
      return true;
    }

    async function connect() {
      if (!checkWallet()) return;

      try {
        log("ðŸ”Œ Connecting...");
        await window.arweaveWallet.connect(["ACCESS_ADDRESS", "DISPATCH"]);
        const addr = await window.arweaveWallet.getActiveAddress();
        log("âœ… Connected:", addr);
        connected = true;
        connectBtn.textContent = "Disconnect";
        testBtn.disabled = false;
      } catch (e) {
        log("âŒ Connect error:", e.message);
      }
    }

    async function disconnect() {
      try {
        await window.arweaveWallet.disconnect();
        log("ðŸ”Œ Disconnected.");
      } catch (e) {
        log("âŒ Disconnect error:", e.message);
      }
      connected = false;
      connectBtn.textContent = "Connect";
      testBtn.disabled = true;
    }

    async function sendTestTx() {
      try {
        log("ðŸ§ª Creating test transaction...");
        const tx = await window.arweaveWallet.dispatch({
          data: "Hello from debug " + Date.now(),
          tags: [{ name: "Content-Type", value: "text/plain" }]
        });
        log("âœ… TX sent:", tx.id);
      } catch (e) {
        log("âŒ TX error:", e.message);
      }
    }

    connectBtn.onclick = () => connected ? disconnect() : connect();
    testBtn.onclick = sendTestTx;

    log("ðŸš€ Wander debug ready. Click Connect.");
  </script>
</body>
</html>
