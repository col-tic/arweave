<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Comentarios con hilos</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
      background: #f7f7f7;
    }

    #commentBox {
      display: flex;
      margin-bottom: 20px;
    }

    #newComment {
      flex: 1;
      padding: 8px;
    }

    button {
      margin-left: 8px;
      padding: 6px 10px;
      cursor: pointer;
    }

    .comment {
      background: white;
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 10px;
      margin: 8px 0;
    }

    .meta {
      font-size: 0.8em;
      color: #555;
      margin-bottom: 5px;
    }

    .replies {
      margin-left: 20px;
      border-left: 2px solid #ddd;
      padding-left: 10px;
    }

    .reply-box {
      margin-top: 8px;
      display: flex;
    }

    .reply-box textarea {
      flex: 1;
      padding: 5px;
    }
  </style>
</head>
<body>

  <h2>üí¨ Comentarios estilo Reddit</h2>

  <!-- Caja para nuevo comentario ra√≠z -->
  <div id="commentBox">
    <textarea id="newComment" placeholder="Escribe un comentario..."></textarea>
    <button onclick="addComment()">Publicar</button>
  </div>

  <div id="comments"></div>

  <script>
    // Simulaci√≥n de comentarios (como si vinieran de Arweave)
    let comments = [
      { txId: "root1", text: "Primer comentario ra√≠z", author: "üë§ Alice", parentId: null },
      { txId: "c2", text: "Respuesta al primer comentario", author: "üë§ Bob", parentId: "root1" },
      { txId: "c3", text: "Otra respuesta al primero", author: "üë§ Carol", parentId: "root1" },
      { txId: "c4", text: "Respuesta a la respuesta de Bob", author: "üë§ Dave", parentId: "c2" }
    ];

    // Generar TXID simple (simulaci√≥n)
    function generateTxId() {
      return Math.random().toString(36).substring(2, 15);
    }

    // Construir √°rbol de hilos
    function buildTree(comments, parentId = null) {
      return comments
        .filter(c => c.parentId === parentId)
        .map(c => ({ ...c, replies: buildTree(comments, c.txId) }));
    }

    // Renderizar √°rbol de comentarios
    function renderComments(tree, container) {
      tree.forEach(comment => {
        const div = document.createElement("div");
        div.className = "comment";
        div.innerHTML = `
          <div class="meta">
            ${comment.author} <br>
            TxID: <a href="https://arweave.net/${comment.txId}" target="_blank">${comment.txId}</a>
          </div>
          <div>${comment.text}</div>
          <button onclick="toggleReplyBox('${comment.txId}')">‚Ü©Ô∏è Responder</button>
          <div id="reply-${comment.txId}" class="reply-box" style="display:none;">
            <textarea id="replyText-${comment.txId}" placeholder="Escribe una respuesta..."></textarea>
            <button onclick="addReply('${comment.txId}')">Responder</button>
          </div>
        `;

        // contenedor de respuestas
        const repliesDiv = document.createElement("div");
        repliesDiv.className = "replies";
        div.appendChild(repliesDiv);

        container.appendChild(div);

        // renderizar recursivamente las respuestas
        renderComments(comment.replies, repliesDiv);
      });
    }

    // Mostrar comentarios en pantalla
    function displayComments() {
      const container = document.getElementById("comments");
      container.innerHTML = "";
      const tree = buildTree(comments);
      renderComments(tree, container);
    }

    // Agregar comentario ra√≠z
    function addComment() {
      const text = document.getElementById("newComment").value.trim();
      if (!text) return;
      const newC = {
        txId: generateTxId(),
        text,
        author: "üë§ Usuario",
        parentId: null
      };
      comments.push(newC);
      console.log("Nuevo comentario:", newC);
      document.getElementById("newComment").value = "";
      displayComments();
    }

    // Mostrar/ocultar caja de respuesta
    function toggleReplyBox(parentId) {
      const box = document.getElementById("reply-" + parentId);
      box.style.display = box.style.display === "none" ? "flex" : "none";
    }

    // Agregar respuesta a un comentario
    function addReply(parentId) {
      const textArea = document.getElementById("replyText-" + parentId);
      const text = textArea.value.trim();
      if (!text) return;
      const newReply = {
        txId: generateTxId(),
        text,
        author: "üë§ Usuario",
        parentId
      };
      comments.push(newReply);
      console.log("Nueva respuesta:", newReply);
      textArea.value = "";
      displayComments();
    }

    // Render inicial
    displayComments();
  </script>
</body>
</html>


